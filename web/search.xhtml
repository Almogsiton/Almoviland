<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <!--
    Page Purpose:
    1. Provides a live search interface for users to find movies by title.
    2. Displays paginated search results dynamically as the user types.
    3. Shows total result count and allows navigation between result pages.
    -->

    <h:form styleClass="search-form">
        <div class="search-bar">
            <h:inputText value="#{movieBean.searchQuery}"
                         styleClass="search-input">
                <f:ajax event="keyup" listener="#{movieBean.searchMovies}" render="results"/>
            </h:inputText>
        </div>

        <h:panelGroup id="results">
            <h3>üîç Results</h3>

            <h:panelGroup rendered="#{not empty movieBean.searchResults}">

                <!-- Display result count -->
                <h4>Found #{movieBean.searchResults.size()} result(s)</h4>

                <div class="movie-row">
                    <!-- Show only the movies for the current page -->
                    <ui:repeat value="#{movieBean.visibleSearchResults}" var="movie">
                        <ui:include src="movieCard.xhtml">
                            <ui:param name="movie" value="#{movie}" />
                        </ui:include>
                    </ui:repeat>
                </div>

                <!-- Pagination buttons -->
                <div class="pagination-controls">
                    <h:commandLink rendered="#{movieBean.hasPreviousSearchPage()}"
                                   action="#{movieBean.previousSearchPage()}"
                                   styleClass="scroll-arrow">
                        <span>‚ùÆ</span>
                        <f:ajax render="results" />
                    </h:commandLink>

                    <h:commandLink rendered="#{movieBean.hasNextSearchPage()}"
                                   action="#{movieBean.nextSearchPage()}"
                                   styleClass="scroll-arrow">
                        <span>‚ùØ</span>
                        <f:ajax render="results" />
                    </h:commandLink>
                </div>

            </h:panelGroup>

            <!-- Message shown when no results are found -->
            <h:panelGroup rendered="#{empty movieBean.searchResults and not empty movieBean.searchQuery}"
                          styleClass="empty-results">
                No movies found matching "<strong>#{movieBean.searchQuery}</strong>".
            </h:panelGroup>

        </h:panelGroup>
    </h:form>
</ui:composition>
