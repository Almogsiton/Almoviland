<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <!--
    Page Purpose:
    1. Allows users to create a new account with personal and credit card information.
    2. Validates password match, email format, and credit card fields.
    3. Enables navigation back to the login page.
    -->


    <h:panelGroup rendered="#{pageController.currentPage eq 'register'}">
        <h1 class="page-title">Register</h1>

        <!-- üõà Borrowing limit info -->
        <!-- Font Awesome icon: displays a gift symbol (üéÅ) for visual enhancement only.
     Used for decoration near subscription or benefit-related text. -->
        <i class="fa fa-gift" aria-hidden="true"></i>

        <h:panelGroup styleClass="subscription-info">
            <i class="fa fa-gift" aria-hidden="true"></i>
            <span>
                With your subscription, you can borrow up to 
                <strong>#{userBean.borrowLimit}</strong> movies!<br/>
                üéÅ Monthly subscription price: 
                <strong>$#{userBean.monthlySubscriptionPrice}</strong>
            </span>
        </h:panelGroup>

        <!-- üîπ Unified form -->
        <h:form id="registerFormFull">
            <h:panelGrid columns="1" styleClass="form-grid">

                <h:outputLabel for="name" value="Full Name:"/>
                <h:inputText id="name" value="#{userBean.newUser.name}" required="true"
                             requiredMessage="Full name is required!"/>
                <h:message for="name" styleClass="error-message"/>

                <h:outputLabel for="email" value="Email:"/>
                <h:inputText id="email" value="#{userBean.newUser.email}" required="true"
                             requiredMessage="Email is required!"
                             validatorMessage="Please enter a valid email address.">>
                    <f:validateRegex pattern="[^@]+@[^@]+\.[^@]+"/>
                </h:inputText>
                <h:message for="email" styleClass="error-message"/>

                <h:outputLabel for="password" value="Password:"/>
                <h:inputSecret id="password" value="#{userBean.newUser.password}" required="true"
                               requiredMessage="Password is required!">
                    <f:validateLength minimum="6"/>
                </h:inputSecret>
                <h:message for="password" styleClass="error-message"/>

                <h:outputLabel for="confirmPassword" value="Confirm Password:"/>
                <h:inputSecret id="confirmPassword" value="#{userBean.confirmPassword}" required="true"
                               requiredMessage="Please confirm your password!">
                    <f:validator validatorId="passwordMatchValidator"/>
                </h:inputSecret>
                <h:message for="confirmPassword" styleClass="error-message"/>

                <h:outputLabel for="creditCard" value="Credit Card Number:"/>
                <h:inputText id="creditCard" value="#{userBean.creditCardNumber}" required="true"
                             maxlength="16" requiredMessage="Credit card number is required!"/>
                <h:message for="creditCard" styleClass="error-message"/>

                <h:outputLabel for="cvc" value="CVC:"/>
                <h:inputText id="cvc" value="#{userBean.cvc}" required="true"
                             maxlength="3" requiredMessage="CVC is required!"/>
                <h:message for="cvc" styleClass="error-message"/>

                <h:outputLabel for="expiryMonth" value="Expiry Month:"/>
                <h:selectOneMenu id="expiryMonth" value="#{userBean.expiryMonth}" required="true">
                    <f:selectItem itemLabel="-- Month --" itemValue="" noSelectionOption="true"/>
                    <f:selectItems value="#{userBean.monthOptions}"/>
                </h:selectOneMenu>
                <h:message for="expiryMonth" styleClass="error-message"/>

                <h:outputLabel for="expiryYear" value="Expiry Year:"/>
                <h:selectOneMenu id="expiryYear" value="#{userBean.expiryYear}" required="true">
                    <f:selectItem itemLabel="-- Year --" itemValue="" noSelectionOption="true"/>
                    <f:selectItems value="#{userBean.yearOptions}"/>
                </h:selectOneMenu>
                <h:message for="expiryYear" styleClass="error-message"/>
            </h:panelGrid>

            <br/>

            <h:panelGrid columns="2" styleClass="button-container">
                <h:commandButton value="Register"
                                 action="#{userBean.registerUser}"
                                 styleClass="action-btn"/>

                <h:commandButton value="Back to Login"
                                 action="#{pageController.setPage('login')}"
                                 styleClass="action-btn"
                                 immediate="true">
                    <f:ajax execute="@form" render="@all"/>
                </h:commandButton>
            </h:panelGrid>

            <!-- Global messages -->
            <h:messages id="messages" globalOnly="true" showDetail="true"
                        infoClass="success-message" errorClass="error-message"/>
        </h:form>
    </h:panelGroup>
</ui:composition>
