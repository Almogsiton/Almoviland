<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <!--
    Page Purpose:
    1. Displays a single movie card with title, image, release date, and average rating.
    2. Allows users to view movie details or borrow the movie (if allowed).
    3. Includes hover overlay for interactive actions and additional info.
    -->

    <h:panelGroup layout="block" styleClass="movie-card">
        <img src="#{movieBean.getMovieImageBase64(movie.movieId)}" class="poster" />

        <!-- Always show title -->
        <div class="card-title">
            #{movie.title}
        </div>

        <!-- Hover overlay shows full info -->
        <div class="overlay">
            <p><b>üìÖ Release:</b>
                <h:outputText value="#{movie.dateRelease}">
                    <f:convertDateTime pattern="yyyy-MM-dd"/>
                </h:outputText>
            </p>
            <p><b>‚≠ê Rating:</b> #{reviewBean.setMovieId(movie.movieId)}#{reviewBean.averageRatingForMovie}</p>
            
            <p><b>üì¶ In Stock:</b> #{movie.copiesAvailable} available</p>

            <div class="icon-actions">
                <h:commandLink styleClass="icon-btn" action="#{movieBean.setSelectedMovie(movie)}">
                    <f:setPropertyActionListener target="#{pageController.currentPage}" value="movieDetails"/>
                    <i class="fa fa-info-circle" title="More Info"></i>
                </h:commandLink>

                <h:commandLink styleClass="icon-btn" action="#{borrowBean.borrowMovie(movie.movieId)}"
                               rendered="#{borrowBean.canUserBorrow()}"
                               onclick="return confirm('Do you want to borrow this movie?');">
                    <i class="fa fa-plus-circle" title="Borrow"></i>
                </h:commandLink>
            </div>

            <h:outputText value="üéØ #{borrowBean.remainingBorrowLimit} left"
                          rendered="#{borrowBean.canUserBorrow()}"
                          styleClass="remaining-borrow" />

            <h:outputText rendered="#{!borrowBean.canUserBorrow()}" 
                          value="Limit reached" 
                          styleClass="limit-reached" />
        </div>
    </h:panelGroup>

</ui:composition>
